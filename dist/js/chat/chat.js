"use strict";$commonRequest.getAuth(function(){location.href=$config.loginPage});var socket=io(),ri=$config.getRoomId()||"admin";function getRoomHistory(){$.ajax({url:"/getCommentList",type:"GET",data:{roomId:ri,userId:userInfo.userId},success:function(e){if(console.log(e),1==e.code){var r="";e.data.map(function(e,o){var n=e.username.slice(e.username.length-1,e.username.length),t=e.userAvatar?nowLocale+e.userAvatar:"",a={userSingleWord:n,userName:e.username+"",userAvatar:t,time:$config.getTime(e.createTime).timeText,content:e.content,nowTime:e.createTime};r+=template("cmtTpl",a)}),$(".comment-area").append(r),$(".comment-area").scrollTop($(".comment-area")[0].scrollHeight)}},error:function(e){console.log(e)}})}function report(e){var o=(new Date).getTime(),n=$(".form-comment input").val().trim();""!=n&&(socket.emit("fabiao",{userId:userInfo.userId,userName:userInfo.username,userAvatar:userInfo.userAvatar,inputVal:n,nowTime:o}),$(".form-comment input").val(""))}function plContent(){$(".form-btn input").focus()}function getRoomInfo(){$.ajax({url:"/getRoomInfo",type:"GET",data:{roomId:ri,userId:userInfo.userId},success:function(e){if(console.log(e),1==e.code){e.data.timeText=$config.getTime(e.data.createTime).timeText;var o=template("roomInfo",e.data),n=template("roomModalTpl",e.data);$(".roomInfo").html(o),$(".roomInfoBody").html(n),$(".roomInfoModalTitle").html(e.data.roomName),$(".roomInfoNum").html("Room [ "+e.data.roomName+" ]")}},error:function(e){console.log(e)}})}function dianzan(e){var o=$(e).attr("nowtime");socket.emit("dianzan",{nowtime:o,dianzan:parseInt($(e).find("em").text())})}$(".userInfo").show(),$(".userInfoName").html("User Name: "+userInfo.username),getRoomInfo(),getRoomHistory(),$(document).keyup(function(e){switch(e.keyCode){case 13:return void report()}}),$(".backToList").click(function(){location.href="/html/list.html"}),$(window).bind("beforeunload",function(){socket.emit("exit",{username:userInfo.username,userId:userInfo.userId,ri:ri})}),socket.on("connect",function(){socket.emit("join",{username:userInfo.username,userId:userInfo.userId,ri:ri})}),socket.on("pinglun",function(e){var o=e.userName,n=o.slice(o.length-1,o.length),t=e.userAvatar?nowLocale+e.userAvatar:"",a={userSingleWord:n,userName:e.userName+"",userAvatar:t,time:e.time,content:e.inputVal,nowTime:e.nowTime},r=template("cmtTpl",a);100<$(".comment-area").children(".comment-item").length&&$(".comment-area").children(".comment-item").eq(0).remove(),$(".comment-area").append(r),$(".comment-area").scrollTop($(".comment-area")[0].scrollHeight)});var dianzanLimit=1e8;socket.on("dianzanTotal",function(e){var o=e.nowtime,n=e.dianzan;parseInt(n)>=dianzanLimit?$(".dianzan[nowtime="+o+"]").find("em").text(dianzanLimit-1+" +"):$(".dianzan[nowtime="+o+"]").find("em").text(n)}),socket.on("userConnect",function(e){var o=e.userCount,n=(e.info,{infoTop:e.info+"，当前用户 ",infoMiddle:e.userCount,infoBottom:" 人"}),t=template("onePsnLink",n);$(".comment-area").append(t),$(".comment-area").scrollTop($(".comment-area")[0].scrollHeight),$(".iconUserCount").text(o)}),socket.on("userExit",function(e){var o={infoTop:"用户 ",infoMiddle:e.userName,infoBottom:" 退出了房间"},n=template("onePsnLink",o);$(".comment-area").append(n),$(".comment-area").scrollTop($(".comment-area")[0].scrollHeight)});